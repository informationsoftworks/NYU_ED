# NYU ED Classification Algorithm

## 05 Dec 2019

The NYU ED classification algorithm depends primarily on a reference set of scores mapped to ICD diagnosis codes.  The original code scoring study was done in 1999, and since then many changes have been made to the ICD9 code set itself, and the US healthcare industry has since moved on to ICD10 anyway.  Over the intervening 20 years, a number of "Updates" or "Patches" have been developed to modernize the algorithm, 3 by the original authors, and two by Health Services Research.  Applying the algorithm to a given set of data requires the user to select one of these mapping sets.  The timeline shown below is intened to help orient the reader to which set may be appropriate for their use case.

### Timeline:

* 2000-11-01: Original NYU ED Algorithm published
* 2010-08-24: Washington State Hospital Association [declares the NYU ED model "outdated"](http://wsha-archive.seattlewebgroup.com/files/169/NYU_Classification_System_for_EDVisits.pdf)
* 2013-10-12: Information Softworks publishes SQL-based version of original algorithm based on programs on NYU website and publishes to github
* 2014-06-13: Spreadsheet "[ED-algorithm-percentages-for-ICD-9-Codes-2009-.xls](https://web.archive.org/web/20150625121326/http://wagner.nyu.edu/files/faculty/ED-algorithm-percentages-for-ICD-9-Codes-2009-.xls)" Created by John Billings, available on the NYU website on or before 2015-01-26
* 2015-07-22: Spreadsheet [NYU_ED_Algorithm_-_ICD-9_Codes_-_6.23.15.xlsx](http://wagner.nyu.edu/files/faculty/NYU_ED_Algorithm_-_ICD-9_Codes_-_6.23.15.xlsx) updated by John Billings.  (Worksheet created by Henry Feldman on 2011-02-11)
* 2015-09-09: NYU website publishes "[list of ICD-10 codes](http://wagner.nyu.edu/files/faculty/NYU_ED_Algorithm_-_ICD-10_Codes_-_6.23.15.xlsx)", revised ICD-9 Codes, and removes "Algorithm" link to https://wagner.nyu.edu/faculty/billings/nyued-download
* 2017-07-19: "[Patch](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5517669/)" to original ICD9 codes developed, paper published
* 2019-12-04: Information Softworks updates github repository

## File list

All the ICD diagnosis scoring data sets have been standardized in column order and name, sorted by diagnosis code, and exported to an RFC-4180 CSV file

### ICD-9 based sets

* `2000_icd9_nyu_original.csv` - 13,366 records
  * The original algorithm used 3 separate tables to identify procedure codes, and used prefix grouping (e.g. "789" to match all 789xx codes), so this file was Generated by processing the ICD9 codes in the file `I9SG_DESC.txt` contained in [Version 23 Effective October 1, 2005 (ZIP)](https://www.cms.gov/Medicare/Coding/ICD9ProviderDiagnosticCodes/Downloads/v23_icd9.zip) archive found on the [CMS Website](https://www.cms.gov/Medicare/Coding/ICD9ProviderDiagnosticCodes/codes), and processing them through the SQL script based on the original MS/Access database tool (see `analysis.sql`)


* `2009_icd9_nyu_update.csv` - 14,314 records
    * Extracted from spreadsheet [ED-algorithm-percentages-for-ICD-9-Codes-2009-.xls](https://web.archive.org/web/20150625121326/http://wagner.nyu.edu/files/faculty/ED-algorithm-percentages-for-ICD-9-Codes-2009-.xls) downloaded from [2015-06-25 snapshot of https://wagner.nyu.edu/faculty/billings/nyued-articles on archive.org](https://web.archive.org/web/20150625121326/https://wagner.nyu.edu/faculty/billings/nyued-articles)
    * Differences from `2000_icd9_nyu_original.csv` (see audit section of `analysis.sql`):
      * 94 ICD codes deleted
      * 1,042 new ICD codes: 971 uncategorized, 71 mapped: 59 injuries, 1 psych, 11 er coded
      * 28 from "categorized" to "uncategorized" (ICD9 "789..")
      * 4,329 went from "uncategorized" to "categorized"
      * 182 changed scoring, 180 special categorized ICD9s removed er scoring, 2 adjusted scoring


* `2015_icd9_nyu_update.csv` - 14,613 records
    * Extracted from spreadsheet [NYU_ED_Algorithm_-_ICD-9_Codes_-_6.23.15.xlsx](http://wagner.nyu.edu/files/faculty/NYU_ED_Algorithm_-_ICD-9_Codes_-_6.23.15.xlsx) downloaded from [https://wagner.nyu.edu/faculty/billings/nyued-background](https://wagner.nyu.edu/faculty/billings/nyued-background)
    * Differences from `2009_icd9_nyu_update.csv` (see audit section of `analysis.sql`):
      * 0 ICD codes deleted
      * 299 new codes (all marked "post2009" = 1), 216 uncategorized
        * Introduced 8 records with fractional "uncategorized"
      * 0 changed categorization (uncat to cat or cat to uncat)
      * 3 codes changed special: alcohol -> drug for ICD9 codes 30400, 30560 and 30590

* `2017_icd9_hesr.csv` - 7,443 records
  * downloaded from ["Click here for additional data file.(184K, txt)"](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5517669/bin/HESR-52-1264-s006.txt) as HESR-52-1264-s006.txt from article "[A “Patch” to the NYU Emergency Department Visit Algorithm](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5517669/)"
  * Fork of NYU 2009 data(?), `2009_icd9_nyu_update.csv`, with these differences:
    * 0 codes deleted (actually 7927 ICD codes "deleted", but all identified as "Uncategorized" in 2009 NYU table, so no net change)
    * 1,056 new ICD codes: all categorized in HESR
    * 0 from "categorized" to "uncategorized" (HESR file does not include uncategorized records)
    * 1,571 went from "uncategorized" to "categorized"
    * 0 adjusted scoring

### ICD-10 based sets

* `2015_icd10_nyu_update.csv` - 69,823 records
    * Extracted from spreadsheet [NYU_ED_Algorithm_-_ICD-10_Codes_-_6.23.15.xlsx](http://wagner.nyu.edu/files/faculty/NYU_ED_Algorithm_-_ICD-10_Codes_-_6.23.15.xlsx) downloaded from [https://wagner.nyu.edu/faculty/billings/nyued-background](https://wagner.nyu.edu/faculty/billings/nyued-background)


* `2017_icd10_hesr.csv` - 47,132 records
  * downloaded from ["Click here for additional data file.(1.1M, txt)"](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5517669/bin/HESR-52-1264-s007.txt) as HESR-52-1264-s007.txt from article "[A “Patch” to the NYU Emergency Department Visit Algorithm](https://www.ncbi.nlm.nih.gov/pmc/articles/PMC5517669/)"
  * Fork of NYU 2015 ICD10 data(?), `2015_icd10_nyu.csv`, with these differences:
    * 66 codes deleted (actually 22,691 ICD codes "deleted", but only 66 identified as "Categorized" in 2015 ICD10 NYU table)
    * 0 new ICD10 codes
    * 0 from "categorized" to "uncategorized" (HESR file does not include uncategorized records)
    * 12,038 went from "uncategorized" to "categorized"
    * 161 adjusted ED scoring
    * 28 adjusted special flag

## Execution Instructions


1. Use `ddl.sql` to create table "nyu_ed_scores" in your database (methods vary,
   depending on database)

2. Select one of the code sets as described in the section above and load into
   the "nyu_ed_scores" table created in step 1

3. Gather discharge records into a single table with a varchar column named "dx"
   containing the diagnosis code (without period)

4. Open the `nyu_ed_query.sql`, and modify line 11 to replace `my_source_data`
   with the name of the table containing the source data intended as input.

5. Execute the query. The resulting table will have the NYU ED scores attached.
   The query may be embeded anywhere in the database, instantiated as a view,
   or cast into a table with an `CREATE TABLE output as ...`.


## Contact

* For information on the **NYU ED Algorithm** itself:
  * see [http://wagner.nyu.edu/faculty/billings/nyued-background](http://wagner.nyu.edu/faculty/billings/nyued-background)
  * or contact: John C. Billings (`john.billings` (at) `nyu.edu`)

* For questions or patches on the **SQL** version:
  * contact Paul Wehr (`sf_nyu_ed` (at) `informationsoftworks.com`)
